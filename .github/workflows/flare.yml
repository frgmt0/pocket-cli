name: "Add Flares to Issues and PRs"

on:
  issues:
    types: [labeled]
  pull_request:
    types: [labeled]

jobs:
  add-flares:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo } = context.repo;
            const issue_number = context.issue.number;
            const label = context.payload.label.name;
            
            // Get current title
            const { data: issue } = await github.rest.issues.get({
              owner,
              repo,
              issue_number
            });
            
            let title = issue.title;
            
            // Remove any existing emojis at the beginning
            title = title.replace(/^(\s*)(ğŸ›|âœ¨|ğŸ“|â“|âš¡ï¸|ğŸ§°|ğŸ”|ğŸ¨|âš¡|ğŸ“¦|ğŸ”–|ğŸ†˜|ğŸš€|ğŸ§ª|ğŸ”§|ğŸ”’)\s+/, '$1');
            
            // Add new emoji based on label
            const flares = {
              'bug': 'ğŸ›',
              'enhancement': 'âœ¨',
              'documentation': 'ğŸ“',
              'question': 'â“',
              'performance': 'âš¡ï¸',
              'backpack': 'ğŸ§°',
              'search': 'ğŸ”',
              'ui': 'ğŸ¨',
              'workflow': 'ğŸš€',
              'dependencies': 'ğŸ“¦',
              'versioning': 'ğŸ”–',
              'help wanted': 'ğŸ†˜',
              'good first issue': 'ğŸ§ª',
              'refactor': 'ğŸ”§',
              'security': 'ğŸ”’'
            };
            
            const flare = flares[label];
            if (flare) {
              const newTitle = `${flare} ${title}`;
              
              await github.rest.issues.update({
                owner,
                repo,
                issue_number,
                title: newTitle
              });
              
              console.log(`Added flare ${flare} to issue/PR #${issue_number}`);
            } 